# API для управления библиотекой

Комплексное API для управления книгами в библиотеке с операциями CRUD, фильтрацией, сортировкой и пагинацией.

## Содержание
- [Обзор](#обзор)
- [Возможности](#возможности)
- [Структура проекта](#структура-проекта)
- [Установка](#установка)
- [Использование](#использование)
- [API Эндпоинты](#api-эндпоинты)
- [Модели](#модели)
- [Валидация](#валидация)
- [Обработка ошибок](#обработка-ошибок)
- [Участие в разработке](#участие-в-разработке)

## Обзор

API для управления библиотекой построено на основе FastAPI и SQLAlchemy, обеспечивая полное решение для отслеживания книг в библиотечной системе. Включает полные операции CRUD, расширенные возможности фильтрации и исчерпывающую документацию.

## Возможности

- **Полные операции CRUD**: Создание, чтение, обновление и удаление книг, авторов и жанров
- **Расширенная фильтрация**: Фильтрация по автору, жанру или названию книги
- **Сортировка**: Сортировка результатов по нескольким полям в восходящем или нисходящем порядке
- **Пагинация**: Настраиваемая пагинация с метаданными
- **Валидация данных**: Комплексная валидация ввода с использованием Pydantic
- **Документация**: Автоматическая документация API с Swagger UI и ReDoc
- **Интеграция с базой данных**: SQLite база данных с ORM SQLAlchemy

## Структура проекта

```
library_api/
├── main.py                 # Основной файл приложения
├── run.py                  # Запуск приложения
├── requirements.txt        # Зависимости проекта
├── db.py                   # Конфигурация базы данных
├── models/
│   ├── __init__.py
│   └── database.py         # SQLAlchemy модели
├── schemas/
│   ├── __init__.py         # Pydantic схемы
├── routers/
│   ├── __init__.py
│   ├── books.py            # Эндпоинты книг
│   ├── authors.py          # Эндпоинты авторов
│   └── genres.py           # Эндпоинты жанров
```

## Установка

1. Клонируйте или скачайте проект
2. Перейдите в директорию проекта
3. Установите зависимости:

```bash
pip install -r requirements.txt
```

## Использование

### Запуск сервера

```bash
cd library_api
python run.py
```

Или с помощью uvicorn напрямую:

```bash
uvicorn main:app --host 127.0.0.1 --port 8000
```

API будет доступен по адресу `http://127.0.0.1:8000`

### Документация API

- Swagger UI: `http://127.0.0.1:8000/docs`
- ReDoc: `http://127.0.0.1:8000/redoc`

## API Эндпоинты

### Книги

- `GET /api/v1/books/` - Получить все книги с фильтрацией, сортировкой и пагинацией
- `POST /api/v1/books/` - Создать новую книгу
- `GET /api/v1/books/{id}` - Получить конкретную книгу по ID
- `PUT /api/v1/books/{id}` - Обновить книгу по ID
- `DELETE /api/v1/books/{id}` - Удалить книгу по ID

### Авторы

- `GET /api/v1/authors/` - Получить всех авторов
- `POST /api/v1/authors/` - Создать нового автора
- `GET /api/v1/authors/{id}` - Получить конкретного автора по ID
- `PUT /api/v1/authors/{id}` - Обновить автора по ID
- `DELETE /api/v1/authors/{id}` - Удалить автора по ID

### Жанры

- `GET /api/v1/genres/` - Получить все жанры
- `POST /api/v1/genres/` - Создать новый жанр
- `GET /api/v1/genres/{id}` - Получить конкретный жанр по ID
- `PUT /api/v1/genres/{id}` - Обновить жанр по ID
- `DELETE /api/v1/genres/{id}` - Удалить жанр по ID

## Параметры запроса для книг

Эндпоинт книг поддерживает следующие параметры запроса:

- `skip` (int, по умолчанию: 0) - Количество записей для пропуска
- `limit` (int, по умолчанию: 10, мин: 1, макс: 100) - Максимальное количество возвращаемых записей
- `author_id` (int, опционально) - Фильтр по ID автора
- `genre_id` (int, опционально) - Фильтр по ID жанра
- `author_name` (str, опционально) - Фильтр по имени автора (частичное совпадение)
- `genre_name` (str, опционально) - Фильтр по названию жанра (частичное совпадение)
- `title` (str, опционально) - Фильтр по названию книги (частичное совпадение)
- `sort_by` (str, по умолчанию: "created_at") - Поле для сортировки
- `sort_order` (str, по умолчанию: "desc") - Порядок сортировки: "asc" или "desc"

## Модели

### Книга
- `id` (int) - Уникальный идентификатор
- `title` (str) - Название книги (обязательно, 1-300 символов)
- `isbn` (str, опционально) - Номер ISBN (макс 20 символов)
- `publication_year` (int, опционально) - Год публикации (1000-2100)
- `description` (str, опционально) - Описание книги
- `page_count` (int, опционально) - Количество страниц (>= 1)
- `author_id` (int) - Внешний ключ к автору (обязательно)
- `genre_id` (int) - Внешний ключ к жанру (обязательно)
- `created_at` (datetime) - Временная метка создания

### Автор
- `id` (int) - Уникальный идентификатор
- `name` (str) - Имя автора (обязательно, 1-200 символов)
- `bio` (str, опционально) - Биография автора

### Жанр
- `id` (int) - Уникальный идентификатор
- `name` (str) - Название жанра (обязательно, 1-100 символов, уникально)

## Валидация

API включает комплексную валидацию:

- Валидация уникальности ISBN
- Валидация внешних ключей (проверка существования связанного автора и жанра)
- Валидация обязательных полей
- Ограничения длины для строковых полей
- Ограничения диапазона для числовых полей
- Правильные ответы об ошибках с кодами статуса 400, 404 и 422

## Обработка ошибок

API возвращает соответствующие коды статуса HTTP:
- `200` - Успешно
- `201` - Создано
- `400` - Неверный запрос (ошибки валидации, дубликат ISBN и т.д.)
- `404` - Не найдено
- `422` - Ошибка валидации

## Примеры запросов

### Создать книгу

```bash
curl -X POST "http://127.0.0.1:8000/api/v1/books/" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Великий Гэтсби",
    "isbn": "978-0-7432-7356-5",
    "publication_year": 1925,
    "page_count": 180,
    "author_id": 1,
    "genre_id": 1
  }'
```

### Получить книги с фильтрами

```bash
curl "http://127.0.0.1:8000/api/v1/books/?author_name=Гэтсби&sort_by=title&sort_order=asc&limit=5"
```

## База данных

Приложение использует SQLite для хранения данных. Файл базы данных `library.db` создается автоматически в корне проекта.

## Зависимости

- FastAPI
- SQLAlchemy
- Pydantic
- uvicorn
- python-multipart

## Участие в разработке

1. Сделайте форк репозитория
2. Создайте ветку для новой функции
3. Внесите свои изменения
4. Добавьте тесты, если применимо
5. Отправьте пул-реквест